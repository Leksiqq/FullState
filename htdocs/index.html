<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
        <title>Net.Leksi.FullState: библиотека для расширения контейнера внедрения зависимости для поддержки служб контекста сессии для сервера ASP.NET Core</title>
        <style>
            body {
              font-family: "Lato", sans-serif;
            }
            
            .sidenav {
              height: 100%;
              -width: 200px;
              width: auto;
              position: fixed;
              z-index: 1;
              top: 0;
              left: 0;
              background-color: rgb(255, 255, 255);
              overflow-x: hidden;
              padding-top: 20px;
              font-size: smaller;
            }
            
            .sidenav a {
              padding: 6px 6px 6px 32px;
              text-decoration: none;
              display: block;
            }
            
            .sidenav span.expander {
              padding: 6px 6px 6px 32px;
              text-decoration: none;
              display: block;
            }
            
            .main {
              margin-left: 200px; /* Same as the width of the sidenav */
            }
            
            @media screen and (max-height: 450px) {
              .sidenav {padding-top: 15px;}
              .sidenav a {font-size: 18px;}
            }
            
            .indent1 {
                margin-left: 10px;
            }
            
            .indent2 {
                margin-left: 20px;
            }
            
            tr td:first-child {
              width: 0;
              white-space: nowrap;
            }
            
            table.members {
                border-collapse: collapse;
            }
            table.members td {
                border: 1px solid black;
                padding: 5px;
            }
            table:not(.members) td {
                border: initial;
                padding: 5px;
            }
            table.methods {
                border-collapse: collapse;
            }
            table.methods tr {
                border: solid gray 1px;
            }
            span.parameter {
                padding: 5px;
                background-color: lightgray;
            }
            td {
                vertical-align: top;
            }
            </style>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" lang="javascript"></script>
            <script lang="javascript">
                $(window).ready(() => {
                    $('span.expander').click(e => {
                        if($(e.target).children('span.expander-icon').hasClass('open')) {
                            $(e.target).children('span.expander-icon').removeClass('open');
                            $(e.target).children('span.expander-icon').addClass('closed');
                            $(e.target).children('span.expander-icon').html('+')
                            $(e.target).children('div').hide();
                        }
                        else {
                            $(e.target).children('span.expander-icon').removeClass('closed');
                            $(e.target).children('span.expander-icon').addClass('open');
                            $(e.target).children('span.expander-icon').html('-')
                            $(e.target).children('div').show();
                        }
                        $('.main').css('margin-left', $('.sidenav').css('width'));
                    });
                    $('span.expander').click();
                });
            </script>
    </head>
    <body>
        <div class="sidenav">
            <a href="index_en.html">In English</a>
            <a style="font-size: larger;" href="#FullState">Net.Leksi.FullState</a>
            <span class="expander"><span class="expander-icon open">+</span> FullStateExtensions
                <div>
                    <a style="font-size: larger;" href="#FullStateExtensions">FullStateExtensions</a>
                    <a style="font-size: larger;" href="#FullStateExtensions.methods">Методы</a>
                </div>
            </span>
            <span class="expander"><span class="expander-icon open">+</span> FullStateOptions
                <div>
                    <a style="font-size: larger;" href="#FullStateOptions">FullStateOptions</a>
                    <a style="font-size: larger;" href="#FullStateOptions.properties">Свойства</a>
                </div>
            </span>
            <span class="expander"><span class="expander-icon open">+</span> IFullState
                <div>
                    <a style="font-size: larger;" href="#IFullState">IFullState</a>
                    <a style="font-size: larger;" href="#IFullState.properties">Свойства</a>
                </div>
            </span>
            <span class="expander"><span class="expander-icon open">+</span> Использование
                <div>
                    <a style="font-size: larger;" href="#DI.config">Конфигурирование контейнера DI</a>
                    <a style="font-size: larger;" href="#App.config">Конфигурирование приложения</a>
                    <a style="font-size: larger;" href="#Access">Доступ к службам</a>
                </div>
            </span>
            <a style="font-size: larger;" href="#sources">Исходники</a>
            <a style="font-size: larger;" href="#packages">Пакеты</a>
        </div>
        <div class="main">
            <a name="FullState"/>
            <h1>Net.Leksi.FullState</h1>
            <p>
                Библиотека предоставляет возможность стандартного использования механизма внедрения зависимости (Dependency Injection) в ASP.NET Core приложениях с сохранением 
                состояния между запросами в течение сессии (full state). Позволяет регистрировать в контейнере DI службы контекста сессии и получать их из контейнера обычным  способом.
                Также предоставляет возможность получать доступ к службам контеста запроса в методах служб контекста сессии.
            </p>
            <a name="FullStateExtensions"/>
            <h2>Класс FullStateExtensions</h2>
            <p>
                Предоставляет методы расширения для типов 
                <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.extensions.dependencyinjection.iservicecollection" target="_blank">IServiceCollection</a>
                и <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.aspnetcore.builder.iapplicationbuilder" target="_blank">IApplicationBuilder</a>.
            </p>
                <script src="https://gist.github.com/Leksiqq/9c26c46546d4d7963b754440e82ac723.js"></script>
            <a name="FullStateExtensions.methods"/>
            <h2>Методы</h2>
            <table class="methods">
                <tr>
                    <td><a href="#AddFullState">AddFullState(IServiceCollection)</a></td>
                    <td>Добавляет инфраструктуру, необходимую для full state сервера</td>
                </tr>
                <tr>
                    <td><a href="">AddFullState(IServiceCollection, Action<FullStateOptions>)</a></td>
                    <td>Добавляет инфраструктуру, необходимую для full state сервера</td>
                </tr>
                <tr>
                    <td><a href="#AddSessional">AddSessional(IServiceCollection, Type)</a></td>
                    <td>Добавляет в данную коллекцию службу указанного типа с ограниченной сессией областью</td>
                </tr>
                <tr>
                    <td><a href="#AddSessional">AddSessional(IServiceCollection, Type, Func&lt;IServiceProvider, object&gt;)</a></td>
                    <td>Добавляет в данную коллекцию службу указанного типа с ограниченной сессией областью и реализующей фабрикой</td>
                </tr>
                <tr>
                    <td><a href="#AddSessional">AddSessional(IServiceCollection, Type, Type)</a></td>
                    <td>Добавляет в данную коллекцию службу указанного типа с ограниченной сессией областью и указанным типом реализации</td>
                </tr>
                <tr>
                    <td><a href="#AddSessional">AddSessional&lt;T1, T2&gt;(IServiceCollection)</a></td>
                    <td>Добавляет в данную коллекцию службу указанного типа с ограниченной сессией областью и указанным типом реализации</td>
                </tr>
                <tr>
                    <td><a href="#AddSessional">AddSessional&lt;T1, T2&gt;(IServiceCollection, Func&lt;IServiceProvider, T2&gt;)</a></td>
                    <td>Добавляет в данную коллекцию службу указанного типа с ограниченной сессией областью и указанным типом реализации и реализующей фабрикой</td>
                </tr>
                <tr>
                    <td><a href="#AddSessional">AddSessional&lt;T1&gt;(IServiceCollection)</a></td>
                    <td>Добавляет в данную коллекцию службу указанного типа с ограниченной сессией областью</td>
                </tr>
                <tr>
                    <td><a href="#AddSessional">AddSessional&lt;T1&gt;(IServiceCollection, Func&lt;IServiceProvider, T1&gt;)</a></td>
                    <td>Добавляет в данную коллекцию службу указанного типа с ограниченной сессией областью и реализующей фабрикой</td>
                </tr>
                <tr>
                    <td><a href="">UseFullState(IApplicationBuilder)</a></td>
                    <td>Добавляет в данное приложение ПО промежуточного слоя для автоматического включения поддержки full state сервера</td>
                </tr>
            </table>
            <a name="AddFullState"></a>
            <h3>Метод AddFullState(...)</h3>
            <p>
                Добавляет инфраструктуру, необходимую для full state сервера. 
            </p>
            <script src="https://gist.github.com/Leksiqq/2cfd1f8217fd45a2653162ffdbc150ce.js"></script>
            <h4>Параметры</h4>
            <p>
                <span class="parameter">services</span> <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.extensions.dependencyinjection.iservicecollection" target="_blank">IServiceCollection</a>
            </p>
            <p>
                Целевая коллекция.
            </p>
            <p>
                <span class="parameter">configure</span> <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.action-1" target="_blank">Action</a>&lt;<a href="#FullStateOptions">FullStateOptions&gt;</a>
            </p>
            <p>
                Делегат для настройки предоставленного набора опций.
            </p>
            <h4>Возвращаемое значение</h4>
            <p>
                <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.extensions.dependencyinjection.iservicecollection" target="_blank">IServiceCollection</a>
            </p>
            <p>
                Целевая коллекция для цепочки вызовов.
            </p>

            <a name="AddSessional"></a>
            <h3>Методы AddSessional(...)</h3>

            <p>
                Добавляют в данную коллекцию службу указанного типа с ограниченной сессией областью и различными возможностями реализации.
            </p>
            <script src="https://gist.github.com/Leksiqq/25451fbc4ec99218e311b791e5ea3aba.js"></script>
            <h4>Параметры типа</h4>
            <p>
                <span class="parameter">TService</span>
            </p>
            <p>
                Тип службы.
            </p>
            <p>
                <span class="parameter">TImplementation</span>
            </p>
            <p>
                Тип реализации службы.
            </p>

            <h4>Параметры</h4>
            <p>
                <span class="parameter">services</span> <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.extensions.dependencyinjection.iservicecollection" target="_blank">IServiceCollection</a>
            </p>
            <p>
                Целевая коллекция.
            </p>
            <p>
                <span class="parameter">serviceType</span> <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.type" target="_blank">Type</a>
            </p>
            <p>
                Тип службы.
            </p>
            <p>
                <span class="parameter">implementationType</span> <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.type" target="_blank">Type</a>
            </p>
            <p>
                Тип реализации службы.
            </p>
            <p>
                <span class="parameter">implementationFactory</span> <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.func-2" target="_blank">Func</a>&lt;<a 
                href="https://docs.microsoft.com/ru-ru/dotnet/api/system.iserviceprovider" target="_blank">IServiceProvider</a>, 
                <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.object" target="_blank">object</a>&gt;, 
                <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.func-2" target="_blank">Func</a>&lt;<a 
                href="https://docs.microsoft.com/ru-ru/dotnet/api/system.iserviceprovider" target="_blank">IServiceProvider</a>, 
                TImplementation&gt;, 
                <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.func-2" target="_blank">Func</a>&lt;<a 
                href="https://docs.microsoft.com/ru-ru/dotnet/api/system.iserviceprovider" target="_blank">IServiceProvider</a>, 
                TService&gt;
            </p>
            <p>
                Реализующая фабрика службы.
            </p>

            <h4>Возвращаемое значение</h4>
            <p>
                <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.extensions.dependencyinjection.iservicecollection" target="_blank">IServiceCollection</a>
            </p>
            <p>
                Целевая коллекция для цепочки вызовов.
            </p>

            <a name="UseFullState"/>
            <h3>Метод UseFullState(...)</h3>
            <p>
                Добавляет в данное приложение ПО промежуточного слоя для автоматического включения поддержки full state сервера.
            </p>
            <script src="https://gist.github.com/Leksiqq/bf561eb13cb178fd8783eed8b0cf07ea.js"></script>
            <h4>Параметры</h4>
            <p>
                <span class="parameter">app</span> <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.aspnetcore.builder.iapplicationbuilder" target="_blank">IApplicationBuilder</a>
            </p>
            <p>
                Целевое приложение.
            </p>

            <h4>Возвращаемое значение</h4>
            <p>
                <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.aspnetcore.builder.iapplicationbuilder" target="_blank">IApplicationBuilder</a>
            </p>
            <p>
                Целевое приложение для цепочки вызовов.
            </p>

            <a name="FullStateOptions"/>
            <h2>Класс FullStateOptions</h2>

            <p>
                Предоставляет набор опций для конфигурирования инфраструктуры.
            </p>

            <script src="https://gist.github.com/Leksiqq/902300e69c625962ff17bcca625b56b3.js"></script>

            <a name="FullStateOptions.properties"/>
            <h2>Свойства</h2>
            <table class="methods">
                <tr>
                    <td>
                        <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.timespan" target="_blank">TimeSpan</a> IdleTimeout
                    </td>
                    <td>
                        Указывает продолжительность бездействия сессии до того, как она будет прекращена. 
                        Каждый доступ к сессии сбрасывает время ожидания. По умолчанию 1 час.
                    </td>
                </tr>
                <tr>
                    <td>
                        <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.timespan" target="_blank">TimeSpan</a> ExpirationScanFrequency
                    </td>
                    <td>
                        Указывает периодичность проверки завершённых сессий для освобождения их ресурсов. По умолчаниию 1 секунда.
                    </td>
                </tr>
                <tr>
                    <td>
                        <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.aspnetcore.http.cookiebuilder" target="_blank">CookieBuilder</a> Cookie
                    </td>
                    <td>
                        Определяет параметры, используемые для создания файлов cookie. 
                        <br/>
                        <br/>Для Name задается значение по умолчанию 
                        <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.aspnetcore.session.sessiondefaults.cookiename" target="_blank">SessionDefaults.CookieName</a>. 
                        <br/>Для Path задается значение по умолчанию <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.aspnetcore.session.sessiondefaults.cookiepath" target="_blank">SessionDefaults.CookiePath</a>. 
                        <br/>Для SameSite задается значение по умолчанию <a href="https://docs.microsoft.com/ru-ru/dotnet/api/microsoft.aspnetcore.http.samesitemode" target="_blank">SameSiteMode.Lax</a>. 
                        <br/>HttpOnlyпо умолчанию имеет значение <b>true</b>.
                        <br/>IsEssential по умолчанию <b>false</b>
                    </td>
                </tr>
            </table>
            <a name="IFullState"/>
            <h2>Интерфейс IFullState</h2>

            <p>
                Предоставляет доступ к службам со временем жизни Http-контекста из служб со временем жизни сесссии.
            </p>

            <script src="https://gist.github.com/Leksiqq/a0219f20f2f07ae8027eb0613bb66374.js"></script>

            <a name="IFullState.properties"/>
            <h2>Свойства</h2>
            <table class="methods">
                <tr>
                    <td>
                        <a href="https://docs.microsoft.com/ru-ru/dotnet/api/system.iserviceprovider" target="_blank">IServiceProvider</a> RequestServices
                    </td>
                    <td>
                        Провайдер служб Http-контекста.
                    </td>
                </tr>
            </table>
            
            <h2>Использование</h2>

            <a name="DI.config"/>
            <h3>Конфигурирование контейнера DI</h3>

            <script src="https://gist.github.com/Leksiqq/51576e62fb5847e1ef7506780443277b.js"></script>

            <p>
                В примере подключается поддержка служб контекста сессии с опциями по умолчанию. Служба <code>InfoProvider</code> регистрируется как служба контекста сессии и при каждом извлечении из контейнера DI 
                в пределах времени жизни сессии будет одним объектом с сохранённым состоянием. Служба <code>Another</code> регистрируется как служба контекста Http-запроса и сохраняет своё состояние в пределах 
                времени обработки запроса.
            </p>

            <a name="App.config"/>
            <h3>Конфигурирование приложения</h3>

            <script src="https://gist.github.com/Leksiqq/94974139fadb4290ec9261aadf34c7d9.js"></script>

            <p>
                В примере добавляется ПО промежуточного слоя для автоматического включения поддержки служб контекста сессии.
            </p>

            <a name="Access"/>
            <h3>Доступ к службам</h3>

            <script src="https://gist.github.com/Leksiqq/f042dad6865185d9af276a4330fb0fce.js"></script>

            <h4>В контроллере и службах из Http-контекста</h4>

            <p>
                В примере объекты <code>another1</code> и <code>another2</code> - один и тот же объект из контекста Http-запроса, <br/>
                объекты <code>infoProvider1</code> и <code>infoProvider3</code> - один и тот же объект из контекста сессии, <br/>
                объекты <code>infoProvider2</code> и <code>infoProvider4</code> - один и тот же объект из контекста Http-запроса (<code>infoProvider1 != infoProvider2</code>).<br/>
                В объекте <code>infoProvider2</code>:<br/>
                объекты <code>another3</code> и <code>another4</code> - один и тот же объект из контекста Http-запроса (все <code>another...</code> совпадают).
            </p>

            <h4>В службах из контекста сессии</h4>
            <p>
                В примере в объекте <code>infoProvider1</code>:<br/>
                объект <code>another3</code> - объект из контекста сессии, <br/>
                объект <code>another4</code> - объект из контекста Http-запроса, (<code>another1 == another4 && another2 == another4</code>).<br/>
            </p>
            <a name="sources"/>
            <h2>Исходники</h2>
            <p>
                <b>GitHub</b>: <a href="https://github.com/Leksiqq/FullState">https://github.com/Leksiqq/FullState</a>
            </p>
            <p>
                <b>SourceForge</b>: <a href="https://sourceforge.net/p/fullstate/code/ci/master/tree/">https://sourceforge.net/p/fullstate/code/ci/master/tree/</a>
            </p>
            <a name="packages"/>
            <h2>Пакеты</h2>
            <p>
                <b>NuGet</b>: <a href="https://www.nuget.org/packages/Net.Leksi.FullState">Net.Leksi.FullState</a>
            </p>
        </div>        
    </body>
</html>